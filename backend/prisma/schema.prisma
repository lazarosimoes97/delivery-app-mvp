generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String       @id @default(uuid())
  name        String
  email       String       @unique
  password    String
  role        String       @default("CLIENT")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  orders      Order[]
  restaurants Restaurant[]
  favorites   Favorite[]
}

model Restaurant {
  id           String    @id @default(uuid())
  name         String
  description  String?
  imageUrl     String?
  ownerId      String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  category     String?
  document     String?
  type         String?
  zipCode      String?
  state        String?
  city         String?
  neighborhood String?
  street       String?
  number       String?
  complement   String?
  reference    String?
  latitude     Float?
  longitude    Float?
  mpUserId     String?
  mpAccessToken String?
  orders       Order[]
  products     Product[]
  favorites    Favorite[]
  owner        User      @relation(fields: [ownerId], references: [id])
}

model Product {
  id           String      @id @default(uuid())
  name         String
  description  String?
  price        Float
  category     String      @default("General")
  imageUrl     String?
  restaurantId String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  orderItems   OrderItem[]
  restaurant   Restaurant  @relation(fields: [restaurantId], references: [id])
}

model Favorite {
  id           String     @id @default(uuid())
  userId       String
  restaurantId String
  createdAt    DateTime   @default(now())
  user         User       @relation(fields: [userId], references: [id])
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])

  @@unique([userId, restaurantId])
}

model Order {
  id            String      @id @default(uuid())
  userId        String
  restaurantId  String
  status        String      @default("PENDING")
  total         Float
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  paymentId     String?
  paymentStatus String      @default("PENDING")
  paymentMethod String?
  mpQrCode      String?
  mpQrCodeBase64 String? @db.Text
  restaurant    Restaurant  @relation(fields: [restaurantId], references: [id])
  user          User        @relation(fields: [userId], references: [id])
  items         OrderItem[]
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Float
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
}
